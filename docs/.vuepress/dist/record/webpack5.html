<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack相关内容 详细版本 | 记录</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="开发中常用的工具方法、css等记录">
    
    <link rel="preload" href="/eweb/assets/css/0.styles.1665cbf6.css" as="style"><link rel="preload" href="/eweb/assets/js/app.d777d41c.js" as="script"><link rel="preload" href="/eweb/assets/js/2.ced4a260.js" as="script"><link rel="preload" href="/eweb/assets/js/10.5853b6b3.js" as="script"><link rel="prefetch" href="/eweb/assets/js/11.cc97d5e5.js"><link rel="prefetch" href="/eweb/assets/js/12.b593d52f.js"><link rel="prefetch" href="/eweb/assets/js/13.7fdebbda.js"><link rel="prefetch" href="/eweb/assets/js/14.05c7ab23.js"><link rel="prefetch" href="/eweb/assets/js/15.6738490a.js"><link rel="prefetch" href="/eweb/assets/js/16.d9b962f3.js"><link rel="prefetch" href="/eweb/assets/js/17.39ead885.js"><link rel="prefetch" href="/eweb/assets/js/18.544a6da7.js"><link rel="prefetch" href="/eweb/assets/js/19.8844a21e.js"><link rel="prefetch" href="/eweb/assets/js/20.e55f1ca8.js"><link rel="prefetch" href="/eweb/assets/js/21.a3a0cae5.js"><link rel="prefetch" href="/eweb/assets/js/22.1de31856.js"><link rel="prefetch" href="/eweb/assets/js/23.2f357b3a.js"><link rel="prefetch" href="/eweb/assets/js/24.7dbf0926.js"><link rel="prefetch" href="/eweb/assets/js/25.08859487.js"><link rel="prefetch" href="/eweb/assets/js/26.5a90d678.js"><link rel="prefetch" href="/eweb/assets/js/27.287d8c15.js"><link rel="prefetch" href="/eweb/assets/js/28.c43adb3a.js"><link rel="prefetch" href="/eweb/assets/js/29.523363e5.js"><link rel="prefetch" href="/eweb/assets/js/3.fa812dab.js"><link rel="prefetch" href="/eweb/assets/js/30.3cb341b7.js"><link rel="prefetch" href="/eweb/assets/js/31.3e0ed910.js"><link rel="prefetch" href="/eweb/assets/js/32.9c2ea1f2.js"><link rel="prefetch" href="/eweb/assets/js/33.e1eadb85.js"><link rel="prefetch" href="/eweb/assets/js/34.3e0b0855.js"><link rel="prefetch" href="/eweb/assets/js/35.8978a168.js"><link rel="prefetch" href="/eweb/assets/js/36.4bc4dbc1.js"><link rel="prefetch" href="/eweb/assets/js/37.1923871e.js"><link rel="prefetch" href="/eweb/assets/js/38.657770b1.js"><link rel="prefetch" href="/eweb/assets/js/39.fc6381a0.js"><link rel="prefetch" href="/eweb/assets/js/4.6c6a5cc7.js"><link rel="prefetch" href="/eweb/assets/js/40.9a156b73.js"><link rel="prefetch" href="/eweb/assets/js/41.88435f8d.js"><link rel="prefetch" href="/eweb/assets/js/42.c31a3e7f.js"><link rel="prefetch" href="/eweb/assets/js/43.c822606a.js"><link rel="prefetch" href="/eweb/assets/js/44.4cd03d6c.js"><link rel="prefetch" href="/eweb/assets/js/45.618a0370.js"><link rel="prefetch" href="/eweb/assets/js/46.14d5bbcd.js"><link rel="prefetch" href="/eweb/assets/js/47.7139d43e.js"><link rel="prefetch" href="/eweb/assets/js/5.7119942c.js"><link rel="prefetch" href="/eweb/assets/js/6.ca630ff3.js"><link rel="prefetch" href="/eweb/assets/js/7.a86623a5.js"><link rel="prefetch" href="/eweb/assets/js/8.552e7e26.js"><link rel="prefetch" href="/eweb/assets/js/9.98f3d992.js">
    <link rel="stylesheet" href="/eweb/assets/css/0.styles.1665cbf6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/eweb/" class="home-link router-link-active"><!----> <span class="site-name">记录</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据结构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/eweb/dataStructure/sparseArray.html" class="sidebar-link">稀疏数组</a></li><li><a href="/eweb/dataStructure/环形队列.html" class="sidebar-link">环形队列</a></li><li><a href="/eweb/dataStructure/单向链表.html" class="sidebar-link">单向链表</a></li><li><a href="/eweb/dataStructure/双向链表.html" class="sidebar-link">双向链表</a></li><li><a href="/eweb/dataStructure/环形链表.html" class="sidebar-link">环形链表</a></li><li><a href="/eweb/dataStructure/栈.html" class="sidebar-link">栈实现简单版计算器</a></li><li><a href="/eweb/dataStructure/逆波兰计算器的实现.html" class="sidebar-link">逆波兰计算器的实现</a></li><li><a href="/eweb/dataStructure/hashTable.html" class="sidebar-link">哈希表</a></li><li><a href="/eweb/dataStructure/tree/binaryTree.html" class="sidebar-link">二叉树基本结构</a></li><li><a href="/eweb/dataStructure/tree/arrBinaryTree.html" class="sidebar-link">顺序存储二叉树</a></li><li><a href="/eweb/dataStructure/tree/threadedBinaryTree.html" class="sidebar-link">线索化二叉树</a></li><li><a href="/eweb/dataStructure/tree/哈夫曼树.html" class="sidebar-link">哈夫曼树</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>算法笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/eweb/algorithm/NSum问题.html" class="sidebar-link">NSUM问题</a></li><li><a href="/eweb/algorithm/前缀和数组.html" class="sidebar-link">前缀和数组问题</a></li><li><a href="/eweb/algorithm/差分数组.html" class="sidebar-link">差分数组</a></li><li><a href="/eweb/algorithm/二维数组的花式遍历.html" class="sidebar-link">二维数组的花式遍历</a></li><li><a href="/eweb/algorithm/双指针技巧.html" class="sidebar-link">双指针技巧</a></li><li><a href="/eweb/algorithm/滑动窗口.html" class="sidebar-link">滑动窗口技巧</a></li><li><a href="/eweb/algorithm/递归.html" class="sidebar-link">递归</a></li><li><a href="/eweb/algorithm/sort/排序.html" class="sidebar-link">排序</a></li><li><a href="/eweb/algorithm/dynamicProgramming/dp01.html" class="sidebar-link">动态规划</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js代码</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/eweb/codeSource/promise/promise.html" class="sidebar-link">promise源码</a></li><li><a href="/eweb/js相关/pub_sub_event_bus.html" class="sidebar-link">pubSub 事件总线</a></li><li><a href="/eweb/js相关/functions.html" class="sidebar-link">call apply bind debounce throttle</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/eweb/record/从输入URL到显示页面的过程.html" class="sidebar-link">从输入URL到显示页面的过程</a></li><li><a href="/eweb/record/http.html" class="sidebar-link">http相关</a></li><li><a href="/eweb/record/js01.html" class="sidebar-link">js 高级 看这里</a></li><li><a href="/eweb/record/vue.html" class="sidebar-link">Vue</a></li><li><a href="/eweb/record/webpack5.html" aria-current="page" class="active sidebar-link">webpack相关内容 详细版本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/eweb/record/webpack5.html#loader的作用" class="sidebar-link">loader的作用</a></li><li class="sidebar-sub-header"><a href="/eweb/record/webpack5.html#插件" class="sidebar-link">插件</a></li><li class="sidebar-sub-header"><a href="/eweb/record/webpack5.html#source-map" class="sidebar-link">source-map</a></li><li class="sidebar-sub-header"><a href="/eweb/record/webpack5.html#hash" class="sidebar-link">hash</a></li><li class="sidebar-sub-header"><a href="/eweb/record/webpack5.html#babel" class="sidebar-link">babel</a></li><li class="sidebar-sub-header"><a href="/eweb/record/webpack5.html#优化配置" class="sidebar-link">优化配置</a></li><li class="sidebar-sub-header"><a href="/eweb/record/webpack5.html#webpack的构建流程是什么" class="sidebar-link">webpack的构建流程是什么</a></li><li class="sidebar-sub-header"><a href="/eweb/record/webpack5.html#webpack热更新的原理" class="sidebar-link">webpack热更新的原理</a></li><li class="sidebar-sub-header"><a href="/eweb/record/webpack5.html#webpack插件如何实现" class="sidebar-link">webpack插件如何实现</a></li><li class="sidebar-sub-header"><a href="/eweb/record/webpack5.html#如何使用webpack优化前端性能" class="sidebar-link">如何使用webpack优化前端性能</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack相关内容-详细版本"><a href="#webpack相关内容-详细版本" class="header-anchor">#</a> webpack相关内容 <a href="https://juejin.cn/post/6844904094281236487" target="_blank" rel="noopener noreferrer">详细版本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h1> <p><img src="/eweb/assets/img/webpack_01.c103c58c.png" alt="img.png"></p> <h2 id="loader的作用"><a href="#loader的作用" class="header-anchor">#</a> loader的作用</h2> <p>webpack只认识json和js文件，其他类型都处理不了，loader的作用就是将webpack不认识的内容转化为认识的内容。</p> <ol><li>css-loader：解析css样式资源</li> <li>style-loader：创建style标签并放在html的head中</li> <li>postcss-loader：自动添加css3部分属性的浏览器前缀</li> <li>less-loader：处理less样式资源</li> <li>sass-loader：处理saas样式资源</li> <li>file-loader: 解决图片引入问题，并将图片copy到指定目录，默认为dist</li> <li>url-loader: 解依赖file-loader，当图片小于limit时，会将图片转为base64，大于limit依然使用file-loader拷贝</li> <li>img-loader：压缩图片</li> <li>babel-loader：使用babel加载ES2015+ 代码兵将其转换为ES5</li> <li>thread-loader：多进程配置。实际上在小型项目中，开启多进程打包反而会增加时间成本，因为启动进程和进程间通信都会有一定开销</li></ol> <h2 id="插件"><a href="#插件" class="header-anchor">#</a> 插件</h2> <p>与Loader用于转换特定类型的文件不同，插件可以贯穿webpack打包的生命周期，执行不同的任务。</p> <ol><li>html-webpack-plugin：将打包后的js、css自动引入到指定的html文件中</li> <li>clean-webpack-plugin：自动清空打包目录</li> <li>mini-css-extract-plugin：分离样式文件，将css以文件形式引入页面</li> <li>optimize-css-assets-webpack-plugin: 压缩css</li> <li>terser-webpack-plugin：压缩js</li> <li>purgecss-webpack-plugin：会单独提取css并清除用不到的css</li></ol> <h2 id="source-map"><a href="#source-map" class="header-anchor">#</a> source-map</h2> <p>校验规则<code>^(inline-|hidden-|eval-)?(nosources-)?(cheap-(module-)?)?source-map$</code></p> <ol><li>inline：代码通过dataUrl形式引入sourceMap</li> <li>hidden：生成sourceMap文件，但不使用</li> <li>eval：<code>eval(...)</code>形式执行代码，通过dataUrl形式引入</li> <li>nosources：不生成sourceMap</li> <li>cheap：只需要定位到行信息，不需要列信息</li> <li>module：展示源代码中的错误位置</li></ol> <p>开发环境推荐配置：<code>eval-cheap-module-source-map</code></p> <ol><li>首次打包慢点，有<code>eval</code>缓存，rebuild会很快</li> <li>只要能定位到行就行，所以加上cheap</li> <li>希望找到源代码的错误，而不是打包后的，所以加上 <code>module</code></li></ol> <p>生产环境建议配置：<code>none</code>，别人就无法看到源代码</p> <h2 id="hash"><a href="#hash" class="header-anchor">#</a> hash</h2> <p>打包后文件名字中的hash值，基础配置中用到的：`filename:&quot;[name][hash:8][ext]&quot;</p> <ol><li>hash：任何一个文件的改动，整个项目的构建hash值都会变</li> <li>chunkhash：文件的改动只会影响其所在chunk的hash值，不同的entry会生出不同的chunkhash</li> <li>contenthash：每个文件都有单独的hash值，文件的改动只会影响自身的hash值</li></ol> <h2 id="babel"><a href="#babel" class="header-anchor">#</a> babel</h2> <h2 id="优化配置"><a href="#优化配置" class="header-anchor">#</a> 优化配置</h2> <ol><li>alias
<ol><li>alias用于创建 import 或 require的别名，来简化模块引用</li> <li>可以避免在多个不同层级的文件中，引入同一模块，需要修改文件路径</li></ol></li> <li>extensions
<ol><li>webpack默认配置，resolve:{extensions: ['.js','.json','wasm']}</li> <li>允许引入模块时不带扩展名</li> <li>注意：高频文件后缀名放前面。有个两个相同的文件 index.js 和 index.json 会优先选择index.js</li></ol></li> <li>modules
<ol><li>告诉webpack解析模块时应该搜索的目录</li> <li>resolve:{modules: [resolve('src'),'node_modules']}</li></ol></li> <li>external
<ol><li><code>external</code>配置选项提供了「从输出的bundle中排出依赖」的方法。</li> <li>例如从cdn中引入某些第三方库，那么这些文件就不用打包到bundle中</li> <li>剥离一些不需要改动的依赖，节省打包时间。</li></ol></li> <li>配置loader时，排出某些不需要解析的目录
<ol><li>include：符合条件的模块进行解析</li> <li>exclude：排出符合条件的模块，不解析。优先级高于include</li> <li>例如在babel-loader中只解析src中的js文件，排出node_modules中的依赖</li></ol></li> <li>babel-loader开启缓存
<ol><li>babel在转译js过程中开销较大，将babel-loader的执行结果缓存起来可以大大缩短编译速度</li> <li>cache-loader：缓存一些开销较大的loader的处理结果，缓存位置：node_modules/.cache/cache-loader</li></ol></li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>      <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(s[ac]|c)ss$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span> <span class="token comment">//匹配所有sass/scss/css文件</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
                <span class="token string">'cache-loader'</span><span class="token punctuation">,</span><span class="token comment">// 获取前面loader转换的结果</span>
                <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
                <span class="token string">'sass-loader'</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="7"><li>Tree-shaking：剔除无用代码，以降低包的体积</li> <li>Scope Hoisting：作用于提升，原理是将多个模块放在同一个作用域下，并重命名防止命名冲突，通过这种方式可以减少函数声明和内存开销</li> <li>提升首屏的加载速度：降低首屏加载文件的体积，首屏不需要的文件进行预加载或者按需加载</li> <li>prefetch和preload：
<ol><li>prefetch：预获取，浏览器空闲的时候进行资源拉取</li> <li>preload：预加载，提前加载后面会用到的关键资源，因为会提前加载，如果不是特殊需要，慎用</li></ol></li></ol> <hr> <h2 id="webpack的构建流程是什么"><a href="#webpack的构建流程是什么" class="header-anchor">#</a> webpack的构建流程是什么</h2> <ol><li><code>初始化参数</code>：解析webpack配置参数，合并shell传入和webpack.config.js文件配置的参数，形成最后的配置结果。</li> <li><code>开始编译</code>：上一步得到的参数初始化compiler对象，注册所有配置的插件，插件监听webpack构建生命周期的事件节点，做出相应的反应，执行对象的run方法开始执行编译。</li> <li><code>确定入口</code>：从配置的entry入口，开始解析文件构建AST语法树，找出依赖，递归下去</li> <li><code>编译模块</code>：递归中根据文件类型和loader配置，调用所有配置的loader对文件进行转换，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过处理</li> <li><code>完成模块编译并输出</code>：递归完事后，得到每个文件结果，包含每个模块以及他们之间的依赖关系，根据entry或分包配置生成代码块chunk</li> <li><code>输出完成</code>：输出所有的chunk到文件系统。</li></ol> <h2 id="webpack热更新的原理"><a href="#webpack热更新的原理" class="header-anchor">#</a> webpack热更新的原理</h2> <p>当文件变化触发webpack进行编译并完成后，通过socket消息告诉浏览器准备刷新。为了减少刷新代价，只刷新变化文件打包后的模块，
webpack-dev-server可以支持热更新，通过生成文件的hash值来对比需要更新的模块，浏览器再进行热替换</p> <h2 id="webpack插件如何实现"><a href="#webpack插件如何实现" class="header-anchor">#</a> webpack插件如何实现</h2> <ol><li>webpack本质是一个事件流机制，核心模块：tapable(Sync + Async)Hooks 构造输出 === compiler(编译) + compilation(创建bundles)</li> <li>compiler对象代表了完整的webpack环境配置。这个对象在启动webpack时被一次性建立，并配置好所有可操作的配置，包括options、loader和plugin。当在webpack环境中应用一个插件时，插件将收到此compiler对象的引用。可以用它来访问webpack的主环境。</li> <li>compilation对象代表了一次资源版本构建。当运行webpack开发环境中间件时，每当检测到一个文件变化，就会创建一个新的compilation，从而生成一个新的编译资源。一个compilation对象表现了当前的资源模块、编译生成资源、变化的文件、以及被跟踪依赖的状态信息。</li> <li>compilation对象也提供了很多关键时机的回调，以供插件做自定义时选择使用</li> <li>创建一个插件函数，在其prototype上定义apply方法，制定一个webpack自身的事件钩子</li> <li>函数内部处理webpack内部实例的特定数据</li> <li>处理完成后，调用webpack提供的回调函数</li></ol> <h2 id="如何使用webpack优化前端性能"><a href="#如何使用webpack优化前端性能" class="header-anchor">#</a> 如何使用webpack优化前端性能</h2> <p>用webpack优化前端性能是指优化webpack的输出结果，让打包的最终结果在浏览器运行速度高效。</p> <ol><li>压缩代码：删除多余的代码、注释、简化代码的写法等方式。</li> <li>利用CDN加速：在构建过程中，将引用的静态资源路径修改为CDN上对应的路径。可以利用webpack对于output参数和各loader的publicPath参数来修改资源路径</li> <li>Tree-Shaking：将代码中永远不会走到的片段删掉。可以通过在启动webpack时追加参数 --optimize-minimize实现。</li> <li>Code Splitting：将代码按路由维度或者组件分块(chunk)，这样做到按需加载，同时可以充分利用浏览器缓存</li> <li>提取公共第三方库：SplitChunksPlugin插件来进行公共模块抽取，利用浏览器缓存可以长期缓存这些无需频繁变动的公共代码</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/eweb/record/vue.html" class="prev">
        Vue
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/eweb/assets/js/app.d777d41c.js" defer></script><script src="/eweb/assets/js/2.ced4a260.js" defer></script><script src="/eweb/assets/js/10.5853b6b3.js" defer></script>
  </body>
</html>
